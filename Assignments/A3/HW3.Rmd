---
title: "Perspectives—HW3"
author: "Sanja Miklin"
date: "10/24/2018"
output: pdf_document
---

```{r setup, include=FALSE}
# use Cairo to allow custom fonts in ggplot
library(Cairo)
knitr::opts_chunk$set(echo = FALSE, dev = "cairo_pdf")
```

## 1. Simulation in Sociology, Moretti (2002)

In her paper on (possible) contributions of computer simulations to sociology, Moretti (2002) examines the ways in which particular kinds of computer modeling can be productively mobilized by sociological theory and practice.

In her discussion of the possibilities and the limitations of computer modeling, Moretti stresses the importance of thinking about the validity of models, that is the degree to which theoretical constructs and the resulting models actually map onto the real world. There are a few specific weaknesses she points to. First, the models have a fixed dynamic structure, and cannot capture the change from one structure to another, which is something that might happen over time in the real world. Second, the models require quantifiable variables, although many aspects of the social worlds are very difficult to quantify, and even when we do quantify them we often rely on yet other models. This presents problems not only in terms of inputs into the model, but also reinterpreting quantitative outputs in qualitatively meaningful terms. Then, specific to the cellular automata models are the issues with the two assumptions of the model: that all states update at the same time, and that the interactions are restricted to the immediate neighborhood, neither of which hold in the real world.

Despite these limitations, however, Moretti emphasizes the usefulness of computer modeling. One of the advantages of computer models that she points to, is that they are good at modeling ‘dynamic feedback’ present in complex systems, that is to say, they allow the researcher to account for the fact that outcomes of a process can influence the process itself. An example of this dynamic feedback that she points to is Forrester’s (1971) model of economic growth that takes into account the effects of the global economic growth on the environment and the consequent effects of these environmental changes on the economic growth. Simulations that explore the emergence of cooperation that she brings up also likely rely on dynamic feedback, as in iterated prisoner’s dilemma scenarios, one partner’s behavior influences the behavior of the other, which in turn influences the behavior of the first partner. 

Thinking of a political science research question that would deal with a dynamic-feedback system, I would be interested in how voter turnout and election results impact voter turnout at the next election. For example, an undesirable outcome might discourage someone who voted from voted again (as they might believe their vote doesn’t make a difference), while it might encourage someone who hasn’t voted to do so at the next elections (hoping to make a difference). Overall participation rates might also impact individual’s decision to vote or not in the next elections, especially in two-round systems.


## 2. Simulating your income
```{r include=FALSE}
#load libraries

library(tidyverse)
library(stats)
library(knitr)
library(scales)
```

Assume that all of you will graduate from MACSS program at the University of Chicago in June 2020. Your annual income from the time you graduate to the end of your life is generated by the following process,  

$ln(inc_{2020}) = ln(inc_0) + ln(\varepsilon_{2020})$ and  

$ln(inc_t) = (1-\rho)[ln(inc_0) + g(t-2020)] + \rho ln(inc_{t-1}) + ln(\varepsilon_t)$  (1)

for $2021 \leq t \leq 2059$

where the variable $inc_t$ is your annual income in year $t \geq 2020$, $inc_0$ is the average starting income $(t = 2018)$ for a MACSS student, $\rho \in [0,1)$ reflects some positive dependence of today’s income on last period’s income, $g$ is a long-run annual growth rate for your annual salary, and $\varepsilon_t$ is an error term that is distributed lognormal $LN(0,\sigma)$ where $\sigma$ is the standard deviation of the log of the error term. That is, $ln(\varepsilon_t)$ is distributed normal $N(0,\sigma)$.

###(a) Simulation of lifetime income
Let the standard deviation of your income process be $\sigma = 0.13$, let the persistence be $\rho = 0.4$, let the long-run growth rate of income be $g = 0.025$, and let average initial income be $inc_0 = \$80, 000$. Assume you will work for 40 years after you graduate (2020 to 2059). Simulate 10,000 different realizations of your lifetime income. Do this by first drawing 10,000 sets of 40 normally distributed errors with mean 0 and standard deviation $\sigma = 0.13$. Then plug those into the income process (1) to simulate your lifetime income. Plot one of the lifetime income paths. Make sure your axes are correctly labeled and your plot has a title.

```{r}
# set variable values
inc_0 <- 80000
p <- 0.4
g <- 0.025
year.start <- 2020
year.end <- 2059
n.years <- year.end-year.start+1
sd.lne <- 0.13

# draw 10,000 sets of 40 ln(errors)
set.seed(123)
nSamples = 10000
ln.errors <- matrix(nrow = nSamples, ncol = n.years)
for (i in 1:nSamples) {
  ln.errors[i,] <- rnorm(n = n.years, mean = 0, sd = sd.lne)
}

# create the simulated income matrix
income <- matrix(NA, ncol = n.years, nrow = nSamples)

# set value for the first year in each simulation
income[,1] <- log(inc_0) +  ln.errors[,1]

# use a for loop to set values for years 2-40.
for (t in 2:n.years) {
        income[,t] <- (1-p)*(log(inc_0) + g*(t-1)) + p*income[, t-1] +     ln.errors[ ,t]
 }

# transform ln(income) into actual income.
income <- exp(income)


# organize data in ways that can be more easily plotted
# create a df, variables are years with named columns, observations are errors
income.hor <- as.data.frame(income)
colnames(income.hor) <- c(year.start:year.end)

# create a df, variables are 'year' and the 10,000 simulations, observations are years
income.vt <- income %>%
    t() %>%
    as.data.frame() %>%
    mutate(year = c(year.start:year.end))

# plot a randomly sampled column from income against year.

ggplot(income.vt, aes(x = year, y=income.vt[,sample(1:ncol(income)-1, 1)])) +
    geom_line(color="#008080") +
    labs(title = "Lifetime income simulation", subtitle = "A possible lifetime income path", x = "Year", y = "Income") +
    theme(text = element_text(family="Avenir Book", color="#008080"))

```


###(b) Distribution of incomes in the first year
Plot a histogram with 50 bins of year t = 2020 initial income for each of the 10,000 simulations. What percent of your class will earn more than \$100,000 in the first year out of the program? What percent of the class will earn less than \$70,000? Is the distribution normally distributed (i.e., symmetric and bell curved)?

```{r}
ggplot(income.hor, aes(x=`2020`))+
    geom_histogram(bins=50, color="#008080", fill="white") +
    geom_vline(aes(xintercept = mean(income.hor$`2020`), color = "mean")) +
    scale_x_continuous(labels = comma) +
    geom_vline(aes(xintercept = median(income.hor$`2020`), color = "median")) +
    scale_color_manual(name = "Statistics", values = c(mean = "#008080", median = "black")) +
    labs(title = "Lifetime income simulation", subtitle="Distribution of the simulated first-year incomes", x="Income in dollars", y="Count") +
    theme(text = element_text(family="Avenir", color="#008080"))

#calculate percent of class that will earn more than $100,000

print(c("% earning more than $100,000", 1- ecdf(income.hor$`2020`)(100000)*100))

#calculcate percent of class that will earn less than $70,000
print(c("% earning less than $70,000", ecdf(income.hor$`2020`)(70000)*100))


```

Around 4.15% of the cass will earn more than \$100,000 in the first year. Around 15.23% of the class will earn less than \$70,000.

The distirbution does seem normal, maybe with a slight right skew (the mean is slighlty higher than the median)

###(c) Paying off debt 
Suppose you graduate from the MACSS program with $95,000 of zero-interest debt. You will use 10% of your annual salary after you graduate to pay off this loan. Plot the histogram of how many years it takes to pay off the loan in each of your 10,000 simulations. This histogram will only have as many bins as you have unique years in which people pay off their debt. In what percent of the simulations are you able to pay off the loan in 10 years (on or before t = 2029)?

```{r}
#set value of debt

debt <- 95000

#create new column in income df, for number of years required to payy of the debt
income.hor <- mutate(income.hor, debt.years=NA)

# using a for loop for each simulation, calculate number of years (while payment < debt) required to pay the debt off 
for (i in 1:nrow(income.hor)) {
    payment <- 0
    no.years <- 1
    while (payment<debt){
        payment <- payment + 0.1*income.hor[i,no.years]
        no.years <- no.years+1
    }
    income.hor$debt.years[i] <- no.years
}

#plot the histgram of debt.years

ggplot(income.hor, aes(x=debt.years))+
    geom_histogram(binwidth=1,color="#008080", fill="white") +
    labs(title = "Lifetime income simulation", subtitle="Number of years necessary to pay off debt", x="Number of years", y="Count") +
    theme(text = element_text(family="Avenir", color="#008080")) 

# find the percent of simulations in which the loan will be paid off in 10 or fewer years.
income.hor %>%
    count(debt.years) %>%
    mutate(percentage = n/sum(n)*100)

# note: can also use ecdf(income.hor$debt.years)(10)
```

The loan would be paid off in 10 years in around 0.36% of cases. In none of the simulations would it be paid off in less than 10 years.

###(d) Paying off debt, take 2.
Now suppose that the Chicago MACSS program becomes very well known in the next two years, and the skills you are learning are demanded more by employers. This increases the average starting salary to $inc_0 = \$90, 000$, but the standard deviation in incomes increases also to $\sigma = 0.174$. Plot the new histogram of how many years it takes to pay off your loan of \$95,000 in your new 10,000 simulations with the new standard deviation and the new average initial salary. In what percent of the simulations are you able to pay off the loan in 10 years (on or before t = 2029)?

```{r}
# Set new starting variables
inc_0 <- 90000
p <- 0.4
g <- 0.025
year.start <- 2020
year.end <- 2059
n.years <- year.end-year.start+1
sd.lne <- 0.17

# Run the simlation with the new variables.
set.seed(123)
nSamples = 10000
ln.errors <- matrix(nrow = nSamples, ncol = n.years)
for (i in 1:nSamples) {
  ln.errors[i,] <- rnorm(n = n.years, mean = 0, sd = sd.lne)
}

income <- matrix(NA, ncol = n.years, nrow = nSamples)
income[,1] <- log(inc_0) +  ln.errors[,1]

for (t in 2:n.years) {
        income[,t] <- (1-p)*(log(inc_0) + g*(t-1)) + p*income[, t-1] +     ln.errors[ ,t]
 }

income <- exp(income)

#create a df, variables are years with named columns, observations are errors
income.hor <- as.data.frame(income)
colnames(income.hor) <- c(year.start:year.end)

# calculate the number of years to pay of the debt.

debt <- 95000

income.hor <- mutate(income.hor, debt.years=NA)

for (i in 1:nrow(income.hor)) {
    payment <- 0
    no.years <- 1
    while (payment<debt){
        payment <- payment + 0.1*income.hor[i,no.years]
        no.years <- no.years+1
    }
    income.hor$debt.years[i] <- no.years
}

ggplot(income.hor, aes(x=debt.years))+
    geom_histogram(binwidth=1,color="#008080", fill="white") +
    labs(title = "Lifetime income simulation", subtitle="Number of years necessary to pay off debt, take 2", x="Number of years", y="Count") +
    theme(text = element_text(family="Avenir", color="#008080")) 



# find the percent of simulations in which the loan will be paid off in 10 or fewer years


print(c("%cases in which debt is payed off within 10 years", ecdf(income.hor$debt.years)(10)*100))



```
 
In this case, the loan will be paid off in 10 or fewer years in around 25.83% of the simulations.
